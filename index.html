<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./TypeScript/build/ArrayRegSearch.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>ArrayRegSearch</title>
</head>
<body class="bg-slate-600 font-mono p-4 text-white">

    <div class="my-12 p-4 bg-slate-400 rounded-xl">
        <h2 id="result" class="text-center text-4xl">
            ArrayRegSearch
        </h2>
        <p class="text-center text-m"> version: 0.0.2 </p>
    </div>

    <div class="py-6"> <h3 class="text-center text-2xl"> - Search Parameters - </h3> </div>

    <div class="flex gap-4 justify-between">
      <div class="w-full max-w">
        <div class="flex items-center gap-5 py-2">
            <div>
                <h1>
                    Select Search Algorthim: 
                </h1>
            </div>
            <select id="search-algo"  class="block p-2 text-sm text-gray-900 bg-gray-50 rounded border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected value="ArrayRegSearch">
                    ArrayRegSearch
                </option>
                <option value="findIndex">
                    findIndex()
                </option>
                <option value="filter">
                    filter()
                </option>
            </select>
        </div>
      </div>

      <div class="w-full max-w">
        <div class="flex items-center gap-5 py-2">
            <div>
                <h1>
                    Select Search Key: 
                </h1>
            </div>
            <select id="search-key"  class="block p-2 text-sm text-gray-900 bg-gray-50 rounded border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected value="uid">
                    UID
                </option>
                <option value="first_name">
                    First Name
                </option>
            </select>
        </div>
      </div>


      <div class="w-full max-w">
        <div class="flex items-center gap-5 py-2">
            <div>
                <h1>
                    Test Type: 
                </h1>
            </div>
            <select id="test-type"  class="block p-2 text-sm text-gray-900 bg-gray-50 rounded border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected value="search_index">
                  Search Index
                </option>
                <option value="search_index_overall">
                  Overall Search Index 
                </option>
            </select>
        </div>
      </div>


    </div>
      

    <div class="w-full max-w">
        <div class="flex items-center gap-2 py-2">
            <div>
                <h1 id="range-value">
                    0
                </h1>
            </div>
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="data-size" value="0" type="range" step="1" min="0" max="50" placeholder="Search">
            <button class="flex-shrink-0 bg-slate-400 hover:bg-teal-700 border-slate-400 hover:bg-slate-500 text-sm border-4 text-white py-1 px-2 rounded" id="get-data-size" type="button">
                Set Search Sample Size
            </button>
        </div>
    </div>


    <div style="display: block;" id="search-index-section">
      <div class="py-6"> <h3 class="text-center text-2xl"> - Search Stats - </h3> </div>

      <div class="flex justify-between">
        <div class="w-full max-w">
          <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Index Found: <span id="index-found">0</span> </h1>
          </div>
        </div>

        <div class="w-full max-w">
            <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Elapsed time: <span id="time">0</span> </h1>
            </div>
        </div>


        <div class="w-full max-w">
            <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Search Sample Size: <span id="size">0</span> </h1>
            </div>
        </div>

      </div>

      <div class="flex justify-between">

        <div class="w-full max-w">
          <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Number of Matches: <span id="match-num">0</span> </h1>
          </div>
        </div>

        <div class="w-full max-w">
            <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> ??: <span id="time">0</span> </h1>
            </div>
        </div>


        <div class="w-full max-w">
            <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> ??: <span id="size">0</span> </h1>
            </div>
        </div>

      </div>


      <div class="py-6"> <h3 class="text-center text-2xl"> - Search - </h3> </div>

      <div class="w-full max-w">
        <div class="flex items-center gap-2 py-2">
            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="search" type="text" placeholder="Search">
            <button class="flex-shrink-0 bg-slate-400 hover:bg-teal-700 border-slate-400 hover:bg-slate-500 text-sm border-4 text-white py-1 px-2 rounded" id="find" type="button">
                Search
            </button>
        </div>
      </div>

      <table class="text-left w-full my-4">
        <thead class="bg-slate-400 flex text-white w-full rounded">
          <tr class="flex w-full mb-2">
            <th class="p-4 text-2xl w-1/2">Index</th>
            <th class="p-4 text-2xl w-1/2">Value</th>
          </tr>
        </thead>
        <tbody id="response-table-preview" class="bg-slate-800 flex flex-col items-center justify-between overflow-y-scroll w-full" style="height: 50vh;">
        </tbody>
      </table>

    </div>


    <div style="display: none;" id="overall-search-index-section">

      <div class="flex justify-center my-12">
        <button class="flex-shrink-0 bg-slate-400 hover:bg-teal-700 border-slate-400 hover:bg-slate-500 text-sm border-4 text-white py-1 px-2 rounded" onclick="test_proformace()" type="button">
          <b>Start Test</b>
        </button>
      </div>

      <div class="flex justify-between">
        <div class="w-full max-w">
          <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Total time taken: <span id="total-time">0</span> </h1>
          </div>
        </div>

        <div class="w-full max-w">
            <div class="flex items-center gap-2 py-2 justify-center justify-items-center">
                <h1> Average Time Taken: <span id="avg-time">0</span> </h1>
            </div>
        </div>
      <div>


    </div>


    <div style="display: none;" id="loading">
        <svg style="margin: auto;background: rgb(71 85 105 / 0%);display: block;position: fixed;top: 0;margin: auto;width: 100%;height: 100%;right: 0;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; background: rgb(71,85,105); display: block;" width="253px" height="253px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
            <g transform="rotate(0 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-1.527777777777778s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(30 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-1.388888888888889s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(60 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-1.2500000000000002s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(90 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-1.1111111111111112s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(120 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.9722222222222223s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(150 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.8333333333333334s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(180 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.6944444444444445s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(210 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.5555555555555556s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(240 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.4166666666666667s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(270 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.2777777777777778s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(300 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="-0.1388888888888889s" repeatCount="indefinite"></animate>
              </rect>
            </g><g transform="rotate(330 50 50)">
              <rect x="47" y="24" rx="3" ry="6" width="6" height="12" fill="#ffffff">
                <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.6666666666666667s" begin="0s" repeatCount="indefinite"></animate>
              </rect>
            </g>
        </svg>
    </div>
</body>
    <script>
      let test_arr = [];
      document.getElementById('find').addEventListener('click', (e) => {
        let search = document.getElementById('search').value.trim();
        let algo = document.getElementById('search-algo').value;
        let key = document.getElementById('search-key').value;

        switch (algo) {
          case 'ArrayRegSearch':
              useArrayRegSearch(search,key);
              break;

          case 'findIndex':
              useFindIndex(search,key)
              break;

          case 'filter':
              useFilter(search,key)
              break;
      
          default:
              break;
        }
      });
      
      document.getElementById('test-type').addEventListener('change', (e) => {
        if (e.target.value == 'search_index') {
          document.getElementById('search-index-section').style.display = 'block';
          document.getElementById('overall-search-index-section').style.display = 'none';
        }else{
          document.getElementById('search-index-section').style.display = 'none';
          document.getElementById('overall-search-index-section').style.display = 'block';
        }
      });

      document.getElementById('get-data-size').addEventListener('click', (e) => {
        let value = document.getElementById('data-size').value;
        getData(value);
      });

      document.getElementById('data-size').addEventListener('change', (e) => {
        document.getElementById('range-value').innerText = e.target.value * 100;
      });

      document.getElementById('search-key').addEventListener('change', (e) => {
        document.getElementById('loading').style.display = 'block';
        setTableContent();
        document.getElementById('loading').style.display = 'none';
      });

      document.getElementById('search-algo').addEventListener('change', (e) => {
        if(e.target.value === 'ArrayRegSearch'){
          document.getElementById('match-num').innerHTML = '0';
        }else{
          document.getElementById('match-num').innerHTML = '-';
        }
        
      });

      // gather random data to search
      async function getData(n = 1){
        document.getElementById('loading').style.display = 'block';

        let temp = [];
        test_arr = [];
        for (let index = 0; index < n; index++) {
          let fetched = await fetch('https://random-data-api.com/api/v2/users?size=100')
          .then((response) => response.json())
          .then((data) => { return data })
          .catch(() => { return [] }); 
          if (isIterable(fetched)) {
            test_arr = [...test_arr, ...fetched];
          }
        }

        setTableContent();
        document.getElementById('size').innerHTML = test_arr.length;
        document.getElementById('loading').style.display = 'none';
      };

      function setTableContent(){
        let key = document.getElementById('search-key').value;
        document.getElementById('response-table-preview').innerHTML = '';
        for (let index = 0; index < test_arr.length; index++) {
          const table_row = `
            <tr class="flex w-full mb-2">
              <td class="p-4 w-1/2">${index}</td>
              <td class="p-4 w-1/2">${test_arr[index][key]}</td>
            </tr>
          `;
          document.getElementById('response-table-preview').innerHTML = document.getElementById('response-table-preview').innerHTML + table_row;
        }
      }

      function isIterable(obj) {
        if (obj == null) {
          return false;
        }
        return typeof obj[Symbol.iterator] === 'function';
      }

      // Standardise preformance testing 

      function test_proformace(n = 10){
        if (test_arr.length < 1) {
          console.log('exit');
          return;
        }

        document.getElementById('loading').style.display = 'block';
        let algo = document.getElementById('search-algo').value;
        let key = document.getElementById('search-key').value;
        let startTime; let elapsed = 0; let total = 0; let avg = 0;

        for (let index = 0; index < n; index++) {
          let rand = Math.floor(Math.random() * test_arr.length) + 1;
          let search = test_arr[index][key];
          if (algo === 'ArrayRegSearch') {
            let arrayRegSearch = new ArrayRegSearch(test_arr,key);
            startTime = performance.now();              
            arrayRegSearch.findIndex(search);
            elapsed = performance.now() - startTime;  
          } else if (algo === 'findIndex'){
            startTime = performance.now();
            test_arr.findIndex(x => x[key] === search);
            elapsed = performance.now() - startTime;
          } else if (algo === 'filter'){
            startTime = performance.now();
            test_arr.filter(x => x[key] === search);
            elapsed = performance.now() - startTime;
          }
          total += elapsed;
        }
        avg = total / n;
        document.getElementById('total-time').innerHTML = total;
        document.getElementById('avg-time').innerHTML = avg;
        document.getElementById('loading').style.display = 'none';
      }

      // using ArrayRegSearch 

      function useArrayRegSearch(search,key){
        let arrayRegSearch = new ArrayRegSearch(test_arr,key);

        var startTime = performance.now();                // ==> test starts
        let found = arrayRegSearch.findIndex(search);
        var elapsed = performance.now() - startTime;      // ==> test ends

        document.getElementById('match-num').innerHTML = arrayRegSearch.getMatchCount();
        document.getElementById('index-found').innerHTML = found == false ? 'No result found' : 'Index: ' + found;
        document.getElementById('time').innerText = elapsed + ' ms';
      }

      // using findIndex 

      function useFindIndex(search,key){
        var startTime = performance.now();
        let found = test_arr.findIndex(x => x[key] === search);
        var elapsed = performance.now() - startTime;

        document.getElementById('index-found').innerHTML = found == false ? 'No result found' : 'Index: ' + found;
        document.getElementById('time').innerText = elapsed + ' millisecond';
      }

      // using filter

      function useFilter(search,key){
        var startTime = performance.now();
        let found = test_arr.filter(x => x[key] === search);
        var elapsed = performance.now() - startTime;

        document.getElementById('index-found').innerHTML = found == false ? 'No result found' : 'Index: ' + found;
        document.getElementById('time').innerText = elapsed + ' millisecond';
      }
    </script>
</html>